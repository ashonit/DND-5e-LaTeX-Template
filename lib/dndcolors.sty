\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Define colors, sampled from the books.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Page
\definecolor {bgtan}      {HTML} {F7F2E5}	% DndReadAloud background
\definecolor {bgtan2018}  {HTML} {F9EFD6} % lighter version of bgtan from the 2018 Basic Rules
\definecolor {pagegold}   {HTML} {B89A67} % pagenumbers and footer
\definecolor {sectiontitlecolor} {HTML} {58180D} % section title color

% Type
\definecolor {titlered}    {HTML} {58180D} % titles
\definecolor {titlegold}   {HTML} {C9AD6A} % titlerules
\definecolor {rulered}     {HTML} {9C2B1B} % triangular rule in statsblock
\definecolor {contourgray} {HTML} {CACCBE} % outline color in part & chapter font
\definecolor {contourblack} {HTML} {000000} % outline color in title font
\definecolor {ornamentedframeinner} {HTML} {000000}
\definecolor {ornamentedframeouteryellow} {HTML} {DEB400}

% High-contrast grayscale
\definecolor {titleblack} {HTML} {000000}
\definecolor {titlegray} {HTML} {303030}
\definecolor {rulegray} {HTML} {303030}
\definecolor {pagegray} {HTML} {303030}
\definecolor {themegray} {HTML} {e0e0e0}
\definecolor {bggray} {HTML} {e0e0e0}
\definecolor {statblockribbongray} {HTML} {303030}
\definecolor {statblockbggray} {HTML} {ffffff}
\definecolor {ornamentedframeoutergray} {HTML} {D0D0D0}

% Modern stat blocks
\definecolor {stattitle24} {HTML} {5B160C} % titles in modern stat blocks
\definecolor {statrule24}  {HTML} {7A3C2F} % rules in modern stat blocks

% Type aliases
\colorlet {contourgrey} {contourgray}

% Trim
\definecolor {BrGreen}       {HTML} {EFEDE5} % Basic Rules
\definecolor {PhbLightGreen} {HTML} {E0E5C1} % PHB Part 1
\definecolor {PhbLightCyan}  {HTML} {B5CEB8} % PHB Part 2
\definecolor {PhbMauve}      {HTML} {DCCCC5} % PHB Part 3
\definecolor {PhbTan}        {HTML} {E5D5AC} % PHB appendix
\definecolor {DmgLavender}   {HTML} {E3CED3} % DMG Part 1
\definecolor {DmgCoral}      {HTML} {F3D7C1} % DMG Part 2
\definecolor {DmgSlateGray}  {HTML} {DBE4E4} % DMG Part 3
\definecolor {DmgLilac}      {HTML} {D7D4D6} % DMG appendix

% Trim aliases
\colorlet {DmgSlateGrey} {DmgSlateGray}

% The color used in \DndSetThemeColor when a new color is not set
\bool_if:NTF \l__dnd_highcontrast_bool {
  \colorlet {themecolor} {themegray} % Set the default theme to Part 1 of the PHB.
}
{
  \colorlet {themecolor} {PhbLightGreen} % Set the default theme to Part 1 of the PHB.
}

% Element colors that change when \DndSetThemeColor is used
\colorlet {commentcolor} {themecolor} % DndComment background
\colorlet {sidebarcolor} {themecolor} % DndSidebar background
\colorlet {tablecolor}   {themecolor} % DndTable even row background

% Element colors that do not respond to \DndSetThemeColor
\bool_if:NTF \l__dnd_highcontrast_bool {
  \colorlet {readaloudcolor} {bggray} % DndReadAloud background
  \colorlet {readaloudbordercolor} {titleblack} % DndReadAloud border color
  \colorlet {titlecolor} {titleblack} %
  \colorlet {titlerulecolor} {titlegray} %
  \colorlet {pagecolor} {pagegray} % pagenumbers and footer
  \colorlet {rulecolor} {rulegray}
  \colorlet {ornamentedframeouter} {ornamentedframeoutergray}
}
{
  \colorlet {readaloudcolor} {bgtan} % DndReadAloud background
  \colorlet {readaloudbordercolor} {titlered} % DndReadAloud border color
  \colorlet {titlecolor} {titlered} %
  \colorlet {titlerulecolor} {titlegold} %
  \colorlet {pagecolor} {pagegold} % pagenumbers and footer
  \colorlet {rulecolor} {rulered}
  \colorlet {ornamentedframeouter} {ornamentedframeouteryellow}
}

% Element colors outside the theme (constant in all resource books)
\definecolor {statblockribbonyellow} {HTML} {E69A28} % stat block top/bottom borders (gold)
\definecolor {statblockbgtan}     {HTML} {FDF1DC} % stat block background (tan)

\bool_if:NTF \l__dnd_highcontrast_bool {
  \colorlet {statblocktitle} {titleblack}
  \colorlet {statblockribbon} {bggray}
  \colorlet {statblockbg} {titleblack}
}
{
  \colorlet {statblocktitle} {titlered}
  \colorlet {statblockribbon} {statblockribbonyellow}
  \colorlet {statblockbg} {statblockbgtan}
}

\colorlet {readaloudcolor} {bgtan} % DndReadAloud background
\colorlet {quotecolor}     {PhbMauve} % DndQuotation background
\definecolor {statblockribbon}   {HTML} {E69A28} % stat block top/bottom borders (gold)
\definecolor {statblockbg14}     {HTML} {FDF1DC} % stat block background (tan)
\definecolor {statblockbg24}     {HTML} {F6F3EE} % new background (off-white)
\definecolor {vehiclestatbg}     {HTML} {F2FFFF} % vehicle stat block background (pale turquoise)
\definecolor {vehiclestatribbon} {HTML} {8777BB}
\definecolor {statborder24}      {HTML} {A7A3A0}
\definecolor {modsavtitle}       {HTML} {ABABAB}
\definecolor {physicalattrscore} {HTML} {EDE6D9}
\definecolor {physicalattrmod}   {HTML} {DED4CC}
\definecolor {mentalattrscore}   {HTML} {D8DAD1}
\definecolor {mentalattrmod}     {HTML} {D0CACA}

% Sets the themecolor and colors for all themed elements
% If called without the optional color, resets the color of all themed elements to the current themecolor
\NewDocumentCommand {\DndSetThemeColor} { O {themecolor} }
  {
    \colorlet {themecolor}   {#1}
    \colorlet {commentcolor} {#1}
    \colorlet {sidebarcolor} {#1}
    \colorlet {tablecolor}   {#1}
  }

% Allows almost all colors to be overridden individually, to implement color schemes
% for example like the GoS sourcebook.
\NewDocumentCommand {\DndSetComplexThemeColor} {
  O {themecolor} % themecolor, tablecolor
  O {themecolor} % commentcolor
  O {themecolor} % sidebarcolor
  O {readaloudcolor} % DndReadAloud background
  O {readaloudbordercolor} % DndReadAloud border color
  O {titlecolor} % titles
  O {titlerulecolor} % titlerules
  O {pagecolor} % pagenumbers and footer
  }
  {
    \colorlet {themecolor}   {#1}
    \colorlet {tablecolor}   {#1}
    \colorlet {commentcolor} {#2}
    \colorlet {sidebarcolor} {#3}
    \colorlet {readaloudcolor} {#4}
    \colorlet {readaloudbordercolor} {#5}
    \colorlet {titlecolor}   {#6}
    \colorlet {titlerulecolor} {#7}
    \colorlet {pagecolor}   {#8}
  }
